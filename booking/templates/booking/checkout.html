{% extends 'core/base.html' %}

{% load static %}

{% load humanize %}

{% block extra_head %}




<link href="{% static 'css/cart.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

{% endblock extra_head %}


{% block content %}
<main>
  <div class="hero small-height jarallax" data-jarallax data-speed="0.2">
    <img class="jarallax-img" src="{% static 'img/hero_home_1.jpg' %}" alt="">
    <div class="wrapper opacity-mask d-flex align-items-center justify-content-center text-center animate_hero" data-opacity-mask="rgba(0, 0, 0, 0.5)">
        <div class="container">
            <small class="slide-animated one">Belleza Beach Resort</small>
            <h1 class="slide-animated two">Checkout</h1>
        </div>
    </div>
</div>

<section class="h-100 gradient-custom">
  <form action="" id="checkout_form">
  <div class="container py-5">
    <div class="row d-flex justify-content-center my-4">
      <div class="col-md-8">
        <div class="card mb-4">
          <div class="card-header py-3">
            <h5 class="mb-0">Booking details</h5>
          </div>
          <div class="card-body">



              <div class="row">
                <div class="col-sm-6">
                    <div class="form-floating mb-4">
                        <input class="form-control" type="text" id="first_name" name="first_name" placeholder="First Name" required>
                        <label for="first_name">Name</label>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-floating mb-4">
                        <input class="form-control" type="text" id="last_name" name="last_name" placeholder="Last Name" required>
                        <label for="last_name">Last name</label>
                    </div>
                </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                  <div class="form-floating mb-4">
                      <input class="form-control" type="email" id="email_contact" name="email_contact" placeholder="Email" required>
                      <label for="email_contact">Email</label>
                  </div>
              </div>
              <div class="col-sm-6">
                  <div class="form-floating mb-4">
                      <input class="form-control" type="text" id="phone_contact" name="phone_contact" placeholder="Telephone" required>
                      <label for="phone_contact">Telephone</label>
                  </div>
              </div>
          </div>

          <h6 class="mb-3">Billing Address </h6>

          <div class="row">
            <div class="col-sm-6">
                <div class="form-floating mb-4">
                    <input class="form-control" type="text" id="address_1" name="address_1" placeholder="Address 1" required>
                    <label for="address_1">Address 1</label>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-floating mb-4">
                    <input class="form-control" type="text" id="address_2" name="address_2" placeholder="Address 2">
                    <label for="address_2">Address 2</label>
                </div>
            </div>
        </div>
        <div class="row">
          <div class="col-sm-6">
              <div class="form-floating mb-4">
                  <input class="form-control" type="text" id="state" name="state" placeholder="State of Residence" required>
                  <label for="state">Residential state </label>
              </div>
          </div>
          <div class="col-sm-6">
              <div class="form-floating mb-4">
                  <input class="form-control" type="text" id="country" name="country" placeholder="Country of Residence" required>
                  <label for="country"> Country </label>
              </div>
          </div>
      </div>
            </form>







          </div>


      </div>
      </div>


      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-header py-3">
            <h5 class="mb-0">Your Booking </h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li
                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                Bookings
                <span>₦{{order.get_total|intcomma}}</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                Service charge
                <span>₦0.00</span>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                <div>
                  <strong>Total amount</strong>
                  <strong>
                    <p class="mb-0">(including VAT)</p>
                  </strong>
                </div>
                <span><strong>₦</strong></span>
              </li>
            </ul>

            <button type="submit" class="btn_1">
              Proceed to Payment
            </button>
          </div>
        </div>
      </div>
      </div>
  </div>
</form>
</section>
</main>
{% endblock content %}

{% block extra_scripts %}

<script type="text/javascript">


var total = '{{order.get_total}}'


var form = document.getElementById('checkout_form')
form.addEventListener('submit', function(e){
    e.preventDefault()
    console.log('Form Submitted...')
    submitFormData()
})


function submitFormData(){
      var userFormData = {
          'first_name': form.first_name.value,
          'last_name': form.last_name.value,
          'email': form.email_contact.value,
          'phone': form.phone_contact.value,
          'total': total,
      }


      var billingInfo = {
            'billing_address_1':form.address_1.value,
            'billing_address_2':form.address_2.value,
            'billing_state':form.state.value,
            'billing_country':form.country.value
            }

      console.log('form data', userFormData, billingInfo)

      var url = "/booking/process_checkout/"

      fetch(url, {
                method: 'POST',
                headers:{
                    'Content-Type':'applicaiton/json',
	    			'X-CSRFToken':csrftoken,
                },

                body:JSON.stringify({'userInfo':userFormData, 'billingInfo': billingInfo}),
            })
            .then((response) => response.json())
            .then((data) => {
                console.log("Order sent for payment ")

                console.log(data)

                cart = {}
                document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";

                profile_id = data['the_profile_id']
                console.log(profile_id)
                order_id = data['the_order_id']
                console.log(order_id)
                window.location.href = `/booking/payment_view/${profile_id}/${order_id}/`
            })
}



</script>


{% endblock extra_scripts %}