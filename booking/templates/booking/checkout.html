{% extends 'core/base.html' %}

{% load static %}

{% load humanize %}

{% block extra_head %}




<link href="{% static 'css/cart.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

{% endblock extra_head %}


{% block content %}
<main>
  <div class="hero small-height jarallax" data-jarallax data-speed="0.2">
    <img class="jarallax-img" src="{% static 'img/hero_home_1.jpg' %}" alt="">
    <div class="wrapper opacity-mask d-flex align-items-center justify-content-center text-center animate_hero" data-opacity-mask="rgba(0, 0, 0, 0.5)">
        <div class="container">
            <small class="slide-animated one">Belleza Beach Resort</small>
            <h1 class="slide-animated two">Checkout</h1>
        </div>
    </div>
</div>

<section class="h-100 gradient-custom">
  <form action="" id="checkout_form">
  <div class="container py-5">
    <div class="row d-flex justify-content-center my-4">
      <div class="col-md-8">
        <div class="card mb-4">
          <div class="card-header py-3">
            <h5 class="mb-0">Booking details</h5>
          </div>
          <div class="card-body">

            <div class="hideable_client_type_enum">

              <label for="selected_client_type">Are you booking on behalf of a company?</label> <br>
              <div class="custom_select" id="selected_days_div">
                <select name="selected_client_type" id="selected_client_type" class="wide" >
                    <option value="" selected disabled> Corporate or personal booking?  </option>
                    <option value="personal" > Personal </option>
                    <option value="corporate" > Corporate </option>
                </select>

            </div>
            </div>

            <hr>


              <div class="hideable_personal_booking_form">
                <div class="row">
                  <div class="col-sm-6">
                      <div class="form-floating mb-4">
                          <input class="form-control" type="text" id="first_name" name="first_name" placeholder="First Name" >
                          <label for="first_name">Name</label>
                      </div>
                  </div>
                  <div class="col-sm-6">
                      <div class="form-floating mb-4">
                          <input class="form-control" type="text" id="last_name" name="last_name" placeholder="Last Name" >
                          <label for="last_name">Last name</label>
                      </div>
                  </div>
              </div>

              <div class="row">
                <div class="col-sm-6">
                    <div class="form-floating mb-4">
                        <input class="form-control" type="email" id="email_contact" name="email_contact" placeholder="Email">
                        <label for="email_contact">Email</label>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-floating mb-4">
                        <input class="form-control" type="text" id="phone_contact" name="phone_contact" placeholder="Telephone">
                        <label for="phone_contact">Telephone</label>
                    </div>
                </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                  <div class="form-floating mb-4">
                      <input class="form-control" type="text" id="personal_address" name="personal_address" placeholder="Personal Address">
                      <label for="address_1">Personal Address</label>
                  </div>
              </div>
              <div class="col-sm-6">
                  <div class="form-floating mb-4">
                      <input class="form-control" type="text" id="other_number" name="other_number" placeholder="Other Number">
                      <label for="other_number">Other Number</label>
                  </div>
              </div>
          </div>
              </div>



              <div class="hideable_coporate_booking_form">

                <div class="row">
                  <div class="col-sm-6">
                      <div class="form-floating mb-4">
                          <input class="form-control" type="text" id="company_name" name="company_name" placeholder="Company Name">
                          <label for="company_name">Company Name</label>
                      </div>
                  </div>
                  <div class="col-sm-6">
                      <div class="form-floating mb-4">
                          <input class="form-control" type="text" id="company_email" name="company_email" placeholder="Company Email">
                          <label for="company_email">Company Email</label>
                      </div>
                  </div>
              </div>

              <div class="row">
                <div class="col-sm-6">
                  <div class="form-floating mb-4">
                      <input class="form-control" type="text" id="company_phone_number" name="company_phone_number" placeholder="Corporate Phone Number">
                      <label for="company_phone_number">Phone Number</label>
                  </div>
              </div>

                <div class="col-sm-6">
                    <div class="form-floating mb-4">
                        <input class="form-control" type="text" id="company_other_phone" name="company_other_phone" placeholder="Other Phone">
                        <label for="company_other_phone">Other Phone Number</label>
                    </div>
                </div>

            </div>


            <div class="row">
              <div class="col-sm-6">
                  <div class="form-floating mb-4">
                      <input class="form-control" type="text" id="company_address" name="company_address" placeholder="Address">
                      <label for="company_address">Address</label>
                  </div>
              </div>
              <div class="col-sm-6">
                  <div class="form-floating mb-4">
                      <input class="form-control" type="text" id="company_nature" name="company_nature" placeholder="Nature of Business">
                      <label for="company_nature">Nature of Business</label>
                  </div>
              </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
                <div class="form-floating mb-4">
                    <input class="form-control" type="text" id="number_of_guests" name="number_of_guests" placeholder="Number of Guests">
                    <label for="number_of_guests">Number of Guests </label>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-floating mb-4">
                    <input class="form-control" type="text" id="company_representative" name="company_representative" placeholder="Company Representative" >
                    <label for="company_representative"> Company Representative </label>
                </div>
            </div>
        </div>
              </div>





            </form>







          </div>


      </div>
      </div>


      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-header py-3">
            <h5 class="mb-0">Your Booking </h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li
                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                Bookings
                <span>₦{{order.get_total|intcomma}}</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                Service charge
                <span>₦0.00</span>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                <div>
                  <strong>Total amount</strong>
                  <strong>
                    <p class="mb-0">(including VAT)</p>
                  </strong>
                </div>
                <span><strong>₦</strong></span>
              </li>
            </ul>

            <button type="submit" class="btn_1">
              Proceed to Payment
            </button>
          </div>
        </div>
      </div>
      </div>
  </div>
</form>
</section>
</main>
{% endblock content %}

{% block extra_scripts %}

<script type="text/javascript">


$(document).ready(function(){


let clientType = null

  // check if package in cart

const checkPackageExist = () => {
  let productTypeArr = [];
  for (let key in cart) {
    for (let keyObj in cart[key]) {
      if (keyObj === 'productType') productTypeArr.push(cart[key][keyObj])
    }
  }
return productTypeArr.includes("package");

}

console.log(checkPackageExist())
console.log($("#selected_client_type").val())
if (checkPackageExist() == false){
  clientType = "personal";
  $(".hideable_personal_booking_form").show();
  $(".hideable_client_type_enum").hide();
  $(".hideable_coporate_booking_form").hide();
}else if (checkPackageExist() == true){
  $(".hideable_client_type_enum").show();
  $(".hideable_personal_booking_form").hide();
  $(".hideable_coporate_booking_form").hide();
  let selected_client_type = $("#selected_client_type")
  selected_client_type.on("change", () => {
    if (selected_client_type.val() == "corporate") {
    clientType = "corporate"
    $(".hideable_coporate_booking_form").show();
    $(".hideable_client_type_enum").show();
    $(".hideable_personal_booking_form").hide();
  } else {
    clientType = "personal";
    $(".hideable_personal_booking_form").show();
    $(".hideable_client_type_enum").show();
    $(".hideable_coporate_booking_form").hide();
  }
  })

}



var total = '{{order.get_total}}'


var form = document.getElementById('checkout_form')
form.addEventListener('submit', function(e){
    e.preventDefault()
    console.log('Form Submitted...')
    submitFormData()
})


function submitFormData(){


  let bookingData;

  if (clientType === "personal"){
    bookingData = {
          'first_name': form.first_name.value,
          'last_name': form.last_name.value,
          'email': form.email_contact.value,
          'phone': form.phone_contact.value,
          "address": form.personal_address.value,
          "other_phone":form.other_number.value,
          'total': total,
    }
  } else {
    bookingData = {
            "company_name": form.company_name.value,
            "company_email": form.company_email.value,
            "company_phone_number": form.company_phone_number.value,
            "company_other_phone": form.company_other_phone.value,
            "company_address": form.company_address.value,
            "company_nature": form.company_nature.value,
            "number_of_guests": form.number_of_guests.value,
            "company_representative": form.company_representative.value,
            'total': total,
    }
  }



      console.log('booking data', bookingData, 'client type', clientType)

      var url = "/booking/process_checkout/"

      fetch(url, {
                method: 'POST',
                headers:{
                    'Content-Type':'applicaiton/json',
	    			'X-CSRFToken':csrftoken,
                },

                body:JSON.stringify({'clientType':clientType, 'bookingData': bookingData}),
            })
            .then((response) => response.json())
            .then((data) => {
                console.log("Order sent for payment ")

                console.log(data)

                cart = {}
                document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";

                profile_id = data['the_profile_id']
                console.log(profile_id)
                order_id = data['the_order_id']
                console.log(order_id)
                window.location.href = `/booking/payment_view/${profile_id}/${order_id}/`
            })
}

})





</script>


{% endblock extra_scripts %}